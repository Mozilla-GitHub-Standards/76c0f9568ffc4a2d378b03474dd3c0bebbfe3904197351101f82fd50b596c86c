!function(n,t){"function"==typeof define&&define.amd?define([],t):n.FxaRelierClient=t()}(this,function(){var n,t,e;return function(i){function r(n,t){return b.call(n,t)}function o(n,t){var e,i,r,o,u,c,a,l,f,s,h,d=t&&t.split("/"),p=g.map,_=p&&p["*"]||{};if(n&&"."===n.charAt(0))if(t){for(d=d.slice(0,d.length-1),n=n.split("/"),u=n.length-1,g.nodeIdCompat&&x.test(n[u])&&(n[u]=n[u].replace(x,"")),n=d.concat(n),f=0;f<n.length;f+=1)if(h=n[f],"."===h)n.splice(f,1),f-=1;else if(".."===h){if(1===f&&(".."===n[2]||".."===n[0]))break;f>0&&(n.splice(f-1,2),f-=2)}n=n.join("/")}else 0===n.indexOf("./")&&(n=n.substring(2));if((d||_)&&p){for(e=n.split("/"),f=e.length;f>0;f-=1){if(i=e.slice(0,f).join("/"),d)for(s=d.length;s>0;s-=1)if(r=p[d.slice(0,s).join("/")],r&&(r=r[i])){o=r,c=f;break}if(o)break;!a&&_&&_[i]&&(a=_[i],l=f)}!o&&a&&(o=a,c=l),o&&(e.splice(0,c,o),n=e.join("/"))}return n}function u(n,t){return function(){var e=y.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),d.apply(i,e.concat([n,t]))}}function c(n){return function(t){return o(t,n)}}function a(n){return function(t){v[n]=t}}function l(n){if(r(m,n)){var t=m[n];delete m[n],w[n]=!0,h.apply(i,t)}if(!r(v,n)&&!r(w,n))throw new Error("No "+n);return v[n]}function f(n){var t,e=n?n.indexOf("!"):-1;return e>-1&&(t=n.substring(0,e),n=n.substring(e+1,n.length)),[t,n]}function s(n){return function(){return g&&g.config&&g.config[n]||{}}}var h,d,p,_,v={},m={},g={},w={},b=Object.prototype.hasOwnProperty,y=[].slice,x=/\.js$/;p=function(n,t){var e,i=f(n),r=i[0];return n=i[1],r&&(r=o(r,t),e=l(r)),r?n=e&&e.normalize?e.normalize(n,c(t)):o(n,t):(n=o(n,t),i=f(n),r=i[0],n=i[1],r&&(e=l(r))),{f:r?r+"!"+n:n,n:n,pr:r,p:e}},_={require:function(n){return u(n)},exports:function(n){var t=v[n];return"undefined"!=typeof t?t:v[n]={}},module:function(n){return{id:n,uri:"",exports:v[n],config:s(n)}}},h=function(n,t,e,o){var c,f,s,h,d,g,b=[],y=typeof e;if(o=o||n,"undefined"===y||"function"===y){for(t=!t.length&&e.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(h=p(t[d],o),f=h.f,"require"===f)b[d]=_.require(n);else if("exports"===f)b[d]=_.exports(n),g=!0;else if("module"===f)c=b[d]=_.module(n);else if(r(v,f)||r(m,f)||r(w,f))b[d]=l(f);else{if(!h.p)throw new Error(n+" missing "+f);h.p.load(h.n,u(o,!0),a(f),{}),b[d]=v[f]}s=e?e.apply(v[n],b):void 0,n&&(c&&c.exports!==i&&c.exports!==v[n]?v[n]=c.exports:s===i&&g||(v[n]=s))}else n&&(v[n]=e)},n=t=d=function(n,t,e,r,o){if("string"==typeof n)return _[n]?_[n](t):l(p(n,t).f);if(!n.splice){if(g=n,g.deps&&d(g.deps,g.callback),!t)return;t.splice?(n=t,t=e,e=null):n=i}return t=t||function(){},"function"==typeof e&&(e=r,r=o),r?h(i,n,t,e):setTimeout(function(){h(i,n,t,e)},4),d},d.config=function(n){return d(n)},n._defined=v,e=function(n,t,e){t.splice||(e=t,t=[]),r(v,n)||r(m,n)||(m[n]=[n,t,e])},e.amd={jQuery:!0}}(),e("components/almond/almond",function(){}),function(n){"undefined"!=typeof module&&module&&module.exports?module.exports=n():"function"==typeof e&&e.amd?e("p-promise",n):P=n()}(function(){function n(n){if(!n.stack)try{throw n}catch(t){}return n}function e(){var n=z(new Error).stack;if(!n)return null;var t=[o(n,1)];return K&&(t=t.concat(K),128===t.length&&t.pop()),t}function i(n){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n)||/at ([^ ]+):(\d+):(?:\d+)$/.exec(n)||/@(.+):(\d+):(?:\d+)$/.exec(n);return t?{fileName:t[1],lineNumber:Number(t[2])}:null}function r(){var n=z(new Error).stack;if(!n)return 0;var t=n.split("\n"),e=t[0].indexOf("@")>0?t[1]:t[2],r=i(e);return r?($=r.fileName,r.lineNumber):0}function o(n,t){for(var e=n.split("\n"),i=[],r=0|t,o=e.length;o>r;++r){var a=e[r];!a||u(a)||c(a)||i.push(a)}return i.join("\n")}function u(n){return-1!==n.indexOf("(module.js:")||-1!==n.indexOf("(node.js:")}function c(n){var t=i(n);return!!t&&t.fileName===$&&t.lineNumber>=J&&t.lineNumber<=mt}function a(n){if(n instanceof Error){var t=n.stack;if(t){if(~t.indexOf(V))return}else t=z(n).stack;t&&(n.stack=[o(t,0)].concat(K||[]).join(V))}}function l(){this.a=null,this.b=null,this.next=null}function f(n){return"object"===n||"function"===n}function s(){if(ut.length)throw ut.shift()}function h(){for(;tt!==et;){var n=tt=tt.next;rt>=1024?et.next=et.next.next:++rt;var t=n.a,e=n.b;n.a=null,n.b=null,S(t,e)}it=!1,K=null}function d(n,t){var e=et.next;e===tt?(et.next=e=new l,e.next=tt):--rt,et=e,e.a=n,e.b=t,it||(it=!0,ot())}function p(){var n=process.domain;n&&(B||(B=t("domain")),B.active=process.domain=null),it&&Z?setImmediate(h):process.nextTick(h),n&&(B.active=process.domain=n)}function _(n){var t=1,e=document.createTextNode(""),i=new nt(n);return i.observe(e,{characterData:!0}),function(){t=-t,e.data=t}}function v(n){return function(){function t(){clearTimeout(e),clearInterval(i),n()}var e=setTimeout(t,0),i=setInterval(t,50)}}function m(n){if(!w.onerror)throw n;w.onerror(n)}function g(n){n._state===ht&&(n._domain&&n._domain.enter(),Y(n._value))}function w(n){return n instanceof W?n:E(new W,n)}function b(n,t){n._state||(n._state=st,n._value=t,N(n))}function y(n,t){n._state||(K&&a(t),n._state=ht,n._value=t,X&&(n._domain=process.domain),N(n))}function x(n,t){t._state||(t._state=n._state,t._value=n._value,t._domain=n._domain,N(t))}function E(n,t){if(n._state)return n;if(t instanceof W)T(n,t);else{var e=typeof t;"object"===e&&null!==t||"function"===e?O(n,t):b(n,t)}return n}function T(n,t){t===n?y(n,new TypeError("You can't resolve a promise with itself")):t._state?x(t,n):I(t,pt,n)}function O(n,t){var e=j(n,t);"function"==typeof e?k(H(n,!1),e,t):b(n,t)}function j(n,t){try{return t.then}catch(e){return y(n,e),null}}function k(n,t,e){try{at.call(t,e,n.resolve,n.reject)}catch(i){n.reject(i)}}function N(n){n._pending&&(A(n,n._op,n._pending),n._pending=null)}function A(n,t,e){if(t>=0)e(n,t);else if(t===pt)d(n,e);else for(var i=0,r=e.length;r>i;i+=2)A(n,e[i],e[i+1])}function I(n,t,e){n._state?A(n,t,e):n._pending?n._op===_t?n._pending.push(t,e):(n._pending=[n._op,n._pending,t,e],n._op=_t):(n._pending=e,n._op=t)}function S(n,t){var e=n._domain||t._domain;K=t._trace;var i=n._state===st?t._cb:t._eb;t._cb=null,t._eb=null,t._domain=null,t._trace=null,null===i?x(n,t):e?e._disposed||(e.enter(),C(t,i,n._value),e.exit()):C(t,i,n._value)}function C(n,t,e){var i;try{i=t(e)}catch(r){return void y(n,r)}E(n,i)}function H(n,t){function i(e,i){if(n){var o=n;n=null,r&&(K?r=null:K=r),e?y(o,t?e:i):E(o,i),r&&(K=r=null)}}var r=w.longStackSupport?e():null;return t?i:{promise:n,resolve:function(n){i(!1,n)},reject:function(n){i(!0,n)}}}function F(){return H(new W,!1)}function U(n){var t=new W;return y(t,n),t}function W(){this._state=0,this._value=void 0,this._domain=null,this._cb=null,this._eb=null,this._op=0,this._pending=null,this._trace=null}function q(n){var t=R(n);return t._state?t:t._clone()}function R(n){function t(n,t){r[t]=n.inspect(),0===--o&&b(e,r)}var e=new W,i=n.length;if("number"!=typeof i)return y(e,new TypeError("input not array-like")),e;for(var r=new Array(i),o=i,u=0;i>u;++u)I(w(n[u]),u,t);return 0===o&&b(e,r),e}function L(n){var t=M(n);return t._state?t:t._clone()}function M(n){function t(n,t){null!==o&&(n._state===ht?(o=null,x(n,e),e=null):(o[t]=n._value,0===--u&&b(e,o)))}var e=new W,i=n.length,r=e;if("number"!=typeof i)return y(e,new TypeError("input not array-like")),e;for(var o=new Array(i),u=i,c=0;i>c;++c)I(w(n[c]),c,t);return 0===u&&b(e,o),r}function D(n,t,e){return M(n).then(function(n){return lt.call(t,void 0,n)},e)}function P(n){function t(t){return at.apply(n,t)}return function(){var n=arguments.length,e=new Array(n+1);e[0]=this;for(var i=0;n>i;++i)e[i+1]=arguments[i];return M(e).then(t)}}function G(n){return function(){var t=new W,e=arguments.length,i=new Array(e+1);for(i[e]=H(t,!0);e--;)i[e]=arguments[e];return Q(t,n,this,i),t}}function Q(n,t,e,i){try{lt.call(t,e,i)}catch(r){y(n,r)}}var $,z=n,J=r(),K=null;(new Error).stack&&(z=function(n){return n});var Y,B,V="\nFrom previous event:\n",X=f(typeof process)&&null!=process&&"[object process]"==={}.toString.call(process),Z="function"==typeof setImmediate,nt=f(typeof MutationObserver)&&MutationObserver||f(typeof WebKitMutationObserver)&&WebKitMutationObserver,tt=new l,et=tt,it=!1,rt=0,ot=X?p:nt?_(h):v(h),ut=[],ct=v(s),at=f.call,lt=f.apply;et.next=tt,Y=X?function(n){throw K=null,ot(),n}:function(n){ut.push(n),ct()};var ft=0,st=1,ht=2,dt=0,pt=-1,_t=-2,vt=w(void 0);w.longStackSupport=!1,w.defer=F,w.reject=U,W.prototype._clone=function(){var n=new W;return T(n,this),n},W.prototype.then=function(n,t){var i=new W;return i._cb="function"==typeof n?n:null,i._eb="function"==typeof t?t:null,w.longStackSupport&&(i._trace=e()),X&&(i._domain=process.domain),this._state?d(this,i):I(this,pt,i),i},W.prototype.done=function(n,t){var e=this;(n||t)&&(e=e.then(n,t)),e=e.then(null,m),I(e,dt,g)},W.prototype.fail=function(n){return this.then(null,n)},W.prototype.fin=function(n){function t(){return w(n()).then(function(){x(e,i)})}var e=this,i=e.then(t,t);return i},W.prototype.spread=function(n,t){return this.then(M).then(function(t){return lt.call(n,void 0,t)},t)},W.prototype.timeout=function(n,t){var i=this._clone();if(this._state===ft){var r=w.longStackSupport?e():null,o=setTimeout(function(){K=r,y(i,new Error(t||"Timed out after "+n+" ms")),K=null},n);I(this,dt,function(){clearTimeout(o)})}return i},W.prototype.delay=function(n){var t=new W;return I(this,dt,function(e){e._state===st?setTimeout(function(){x(e,t)},n):vt.then(function(){x(e,t)})}),t},W.prototype.all=function(){return this.then(M)},W.prototype.allSettled=function(){return this.then(R)},W.prototype.inspect=function(){switch(this._state){case ft:return{state:"pending"};case st:return{state:"fulfilled",value:this._value};case ht:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}},W.prototype.nodeify=function(n){return n?void this.done(function(t){n(null,t)},n):this},w.allSettled=q,w.all=L,w.spread=D,w.promised=P,w.denodeify=G,w.onerror=null,w.nextTick=function(n){var t=vt.then(function(){n.call()});I(t,dt,g)};var mt=r();return w}),e("client/lib/object",[],function(){function n(n){for(var t,e=[].slice.call(arguments,1),i=0;t=e[i];++i)for(var r in t)n[r]=t[r];return n}return{extend:n}}),e("client/lib/options",[],function(){function n(n,t){for(var e,i=0;e=n[i];++i)if(!(e in t))throw new Error(e+" is required")}return{checkRequired:n}}),e("client/lib/constants",[],function(){return{DEFAULT_CONTENT_HOST:"https://accounts.firefox.com",DEFAULT_OAUTH_HOST:"https://oauth.accounts.firefox.com/v1/authorization",SIGNIN_ACTION:"signin",SIGNUP_ACTION:"signup",FORCE_AUTH_ACTION:"force_auth"}}),e("client/lib/url",[],function(){function n(n,t){return n+"="+encodeURIComponent(t)}function t(t){var e=[];for(var i in t)e.push(n(i,t[i]));return"?"+e.join("&")}return{createQueryParam:n,objectToQueryString:t}}),e("client/auth/api",["p-promise","client/lib/constants","client/lib/options","client/lib/url"],function(n,t,e,i){function r(n,e){if(!n)throw new Error("clientId is required");this._clientId=n,this._contentHost=e.contentHost||t.DEFAULT_CONTENT_HOST,this._oauthHost=e.oauthHost||t.DEFAULT_OAUTH_HOST,this._window=e.window||window}function o(t,i){var r=this;return n().then(function(){var n=["scope","state","redirect_uri"];e.checkRequired(n,i);var o=u.call(r,t,i);return r.openFxa(o)})}function u(n,t){var e={action:n,client_id:this._clientId,state:t.state,scope:t.scope,redirect_uri:t.redirect_uri};return t.email&&(e.email=t.email),this._oauthHost+i.objectToQueryString(e)}return r.prototype={openFxa:function(){throw new Error("openFxa must be overridden")},signIn:function(n){return n=n||{},o.call(this,t.SIGNIN_ACTION,n)},forceAuth:function(i){var r=this;return n().then(function(){i=i||{};var n=["email"];return e.checkRequired(n,i),o.call(r,t.FORCE_AUTH_ACTION,i)})},signUp:function(n){return o.call(this,t.SIGNUP_ACTION,n)}},r}),e("client/auth/lightbox/lightbox",[],function(){function n(n,t,e){var i=n.document.createElement(t);for(var r in e)i.setAttribute(r,e[r]);return i}function t(n){var t="";for(var e in n)t+=e+":"+n[e]+";";return t}function e(n){n=n||{},this._window=n.window}return e.prototype={load:function(e){var i=this._backgroundEl=n(this._window,"div",{style:t({background:"rgba(0,0,0,0.5)",bottom:0,left:0,position:"fixed",right:0,top:0})}),r=n(this._window,"iframe",{id:"fxa",src:e,width:"600",height:"400",allowtransparency:"true",border:"0",style:t({background:"transparent",border:"none",display:"block",height:"600px",margin:"0 auto 0 auto",position:"relative",top:"10%",width:"400px"})});i.appendChild(r),this._window.document.body.appendChild(i),this._iframe=r,this._contentWindow=r.contentWindow},getContentElement:function(){return this._iframe},getContentWindow:function(){return this._contentWindow},isLoaded:function(){return!!this._backgroundEl},unload:function(){this._backgroundEl&&(this._window.document.body.removeChild(this._backgroundEl),delete this._backgroundEl,delete this._iframe)}},e}),e("client/auth/lightbox/iframe_channel",["p-promise","client/lib/object"],function(n,t){function e(n){n=n||{},this._window=n.window,this._contentWindow=n.contentWindow,this._iframeHost=n.iframeHost}function i(n){if(n.origin===this._iframeHost){var t=r(n.data),e=t.command,i=t.data,o=u[e]||u.ignore;o.call(this,e,i)}}function r(n){var t=n.split("!!!");return{command:t[0],data:JSON.parse(t[1]||"{}")}}function o(n,t){return n+"!!!"+JSON.stringify(t||"")}e.prototype={version:"0.0.0",attach:function(){return this._boundOnMessage=i.bind(this),this._window.addEventListener("message",this._boundOnMessage,!1),this._deferred=n.defer(),this._deferred.promise},detach:function(){this._window.removeEventListener("message",this._boundOnMessage,!1)},send:function(n,e){var i=t.extend({version:this.version},e),r=o(n,i);this._contentWindow.postMessage(r,this._iframeHost)}};var u={error:function(n,t){this.detach(),this._deferred.reject(t)},ping:function(n,t){this.send(n,t)},ignore:function(n){console.log("ignoring command: %s",n)},oauth_cancel:function(){return this.detach(),this._deferred.reject({reason:"cancel"})},oauth_complete:function(n,t){this.detach(),this._deferred.resolve(t)}};return e.stringifyFxAEvent=o,e.parseFxAEvent=r,e}),e("client/auth/lightbox/api",["p-promise","client/lib/object","client/lib/options","../api","./lightbox","./iframe_channel"],function(n,t,e,i,r,o){function u(){var n=this;return n._lightbox?n._lightbox:(n._lightbox=new r({window:n._window}),n._lightbox)}function c(t){var e=this;return n().then(function(){if(e._lightbox&&e._lightbox.isLoaded())throw new Error("lightbox already open");var n=u.call(e);return n.load(t),n})}function a(n){var t=this;return t._channel?t._channel:(t._channel=new o({iframeHost:t._contentHost,contentWindow:n.getContentWindow(),window:t._window}),t._channel)}function l(t){var e=this;return n().then(function(){var n=a.call(e,t);return n.attach()})}function f(n,t){i.call(this,n,t),t=t||{},this._lightbox=t.lightbox,this._channel=t.channel}return f.prototype=Object.create(i.prototype),t.extend(f.prototype,{openFxa:function(n){var t=this;return c.call(t,n).then(function(n){return l.call(t,n)}).then(function(n){return t.unload(),n},function(n){throw t.unload(),n})},unload:function(){var t=this;return n().then(function(){if(!t._lightbox)throw new Error("lightbox not open");t._lightbox.unload(),t._channel.detach()})}}),f}),e("client/auth/redirect/api",["../api","client/lib/constants","client/lib/options","client/lib/object"],function(n,t,e,i){function r(t,e){n.call(this,t,e)}return r.prototype=Object.create(n.prototype),i.extend(r.prototype,{openFxa:function(n){this._window.location.href=n}}),r}),e("client/FxaRelierClient",["p-promise","client/auth/lightbox/api","client/auth/redirect/api"],function(n,t,e){function i(n,t,e,i){if(n._ui)throw new Error("Firefox Accounts is already open");if("object"==typeof t)n._ui=t;else{t=t||"default";var r=o[t];if(!r)throw new Error("Invalid ui: "+t);n._ui=new r(e,i)}return n._ui}function r(t,e){if(!t)throw new Error("clientId is required");this.auth={signIn:function(r){var o=this;return n().then(function(){r=r||{};var n=i(o,r.ui,t,e);return n.signIn(r).fin(function(){delete o._ui})})},forceAuth:function(r){var o=this;return n().then(function(){r=r||{};var n=i(o,r.ui,t,e);return n.forceAuth(r).fin(function(){delete o._ui})})},signUp:function(r){var o=this;return n().then(function(){r=r||{};var n=i(o,r.ui,t,e);return n.signUp(r).fin(function(){delete o._ui})})}}}var o={"default":e,lightbox:t,redirect:e};return r.prototype={version:"0.0.0"},r}),n("client/FxaRelierClient")});
//# sourceMappingURL=fxa-relier.client.min.js.map