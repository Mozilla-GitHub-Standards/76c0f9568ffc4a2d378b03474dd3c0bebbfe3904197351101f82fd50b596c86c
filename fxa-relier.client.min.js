!function(n,t){"function"==typeof define&&define.amd?define([],t):n.FxaRelierClient=t()}(this,function(){var n,t,e;return function(r){function i(n,t){return b.call(n,t)}function o(n,t){var e,r,i,o,u,c,a,l,f,s,h,d=t&&t.split("/"),p=g.map,_=p&&p["*"]||{};if(n&&"."===n.charAt(0))if(t){for(d=d.slice(0,d.length-1),n=n.split("/"),u=n.length-1,g.nodeIdCompat&&x.test(n[u])&&(n[u]=n[u].replace(x,"")),n=d.concat(n),f=0;f<n.length;f+=1)if(h=n[f],"."===h)n.splice(f,1),f-=1;else if(".."===h){if(1===f&&(".."===n[2]||".."===n[0]))break;f>0&&(n.splice(f-1,2),f-=2)}n=n.join("/")}else 0===n.indexOf("./")&&(n=n.substring(2));if((d||_)&&p){for(e=n.split("/"),f=e.length;f>0;f-=1){if(r=e.slice(0,f).join("/"),d)for(s=d.length;s>0;s-=1)if(i=p[d.slice(0,s).join("/")],i&&(i=i[r])){o=i,c=f;break}if(o)break;!a&&_&&_[r]&&(a=_[r],l=f)}!o&&a&&(o=a,c=l),o&&(e.splice(0,c,o),n=e.join("/"))}return n}function u(n,t){return function(){var e=y.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),d.apply(r,e.concat([n,t]))}}function c(n){return function(t){return o(t,n)}}function a(n){return function(t){v[n]=t}}function l(n){if(i(m,n)){var t=m[n];delete m[n],w[n]=!0,h.apply(r,t)}if(!i(v,n)&&!i(w,n))throw new Error("No "+n);return v[n]}function f(n){var t,e=n?n.indexOf("!"):-1;return e>-1&&(t=n.substring(0,e),n=n.substring(e+1,n.length)),[t,n]}function s(n){return function(){return g&&g.config&&g.config[n]||{}}}var h,d,p,_,v={},m={},g={},w={},b=Object.prototype.hasOwnProperty,y=[].slice,x=/\.js$/;p=function(n,t){var e,r=f(n),i=r[0];return n=r[1],i&&(i=o(i,t),e=l(i)),i?n=e&&e.normalize?e.normalize(n,c(t)):o(n,t):(n=o(n,t),r=f(n),i=r[0],n=r[1],i&&(e=l(i))),{f:i?i+"!"+n:n,n:n,pr:i,p:e}},_={require:function(n){return u(n)},exports:function(n){var t=v[n];return"undefined"!=typeof t?t:v[n]={}},module:function(n){return{id:n,uri:"",exports:v[n],config:s(n)}}},h=function(n,t,e,o){var c,f,s,h,d,g,b=[],y=typeof e;if(o=o||n,"undefined"===y||"function"===y){for(t=!t.length&&e.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(h=p(t[d],o),f=h.f,"require"===f)b[d]=_.require(n);else if("exports"===f)b[d]=_.exports(n),g=!0;else if("module"===f)c=b[d]=_.module(n);else if(i(v,f)||i(m,f)||i(w,f))b[d]=l(f);else{if(!h.p)throw new Error(n+" missing "+f);h.p.load(h.n,u(o,!0),a(f),{}),b[d]=v[f]}s=e?e.apply(v[n],b):void 0,n&&(c&&c.exports!==r&&c.exports!==v[n]?v[n]=c.exports:s===r&&g||(v[n]=s))}else n&&(v[n]=e)},n=t=d=function(n,t,e,i,o){if("string"==typeof n)return _[n]?_[n](t):l(p(n,t).f);if(!n.splice){if(g=n,g.deps&&d(g.deps,g.callback),!t)return;t.splice?(n=t,t=e,e=null):n=r}return t=t||function(){},"function"==typeof e&&(e=i,i=o),i?h(r,n,t,e):setTimeout(function(){h(r,n,t,e)},4),d},d.config=function(n){return d(n)},n._defined=v,e=function(n,t,e){t.splice||(e=t,t=[]),i(v,n)||i(m,n)||(m[n]=[n,t,e])},e.amd={jQuery:!0}}(),e("components/almond/almond",function(){}),function(n){"undefined"!=typeof module&&module&&module.exports?module.exports=n():"function"==typeof e&&e.amd?e("p-promise",n):P=n()}(function(){function n(n){if(!n.stack)try{throw n}catch(t){}return n}function e(){var n=z(new Error).stack;if(!n)return null;var t=[o(n,1)];return K&&(t=t.concat(K),128===t.length&&t.pop()),t}function r(n){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n)||/at ([^ ]+):(\d+):(?:\d+)$/.exec(n)||/@(.+):(\d+):(?:\d+)$/.exec(n);return t?{fileName:t[1],lineNumber:Number(t[2])}:null}function i(){var n=z(new Error).stack;if(!n)return 0;var t=n.split("\n"),e=t[0].indexOf("@")>0?t[1]:t[2],i=r(e);return i?($=i.fileName,i.lineNumber):0}function o(n,t){for(var e=n.split("\n"),r=[],i=0|t,o=e.length;o>i;++i){var a=e[i];!a||u(a)||c(a)||r.push(a)}return r.join("\n")}function u(n){return-1!==n.indexOf("(module.js:")||-1!==n.indexOf("(node.js:")}function c(n){var t=r(n);return!!t&&t.fileName===$&&t.lineNumber>=J&&t.lineNumber<=mt}function a(n){if(n instanceof Error){var t=n.stack;if(t){if(~t.indexOf(B))return}else t=z(n).stack;t&&(n.stack=[o(t,0)].concat(K||[]).join(B))}}function l(){this.a=null,this.b=null,this.next=null}function f(n){return"object"===n||"function"===n}function s(){if(ut.length)throw ut.shift()}function h(){for(;tt!==et;){var n=tt=tt.next;it>=1024?et.next=et.next.next:++it;var t=n.a,e=n.b;n.a=null,n.b=null,F(t,e)}rt=!1,K=null}function d(n,t){var e=et.next;e===tt?(et.next=e=new l,e.next=tt):--it,et=e,e.a=n,e.b=t,rt||(rt=!0,ot())}function p(){var n=process.domain;n&&(Y||(Y=t("domain")),Y.active=process.domain=null),rt&&Z?setImmediate(h):process.nextTick(h),n&&(Y.active=process.domain=n)}function _(n){var t=1,e=document.createTextNode(""),r=new nt(n);return r.observe(e,{characterData:!0}),function(){t=-t,e.data=t}}function v(n){return function(){function t(){clearTimeout(e),clearInterval(r),n()}var e=setTimeout(t,0),r=setInterval(t,50)}}function m(n){if(!w.onerror)throw n;w.onerror(n)}function g(n){n._state===ht&&(n._domain&&n._domain.enter(),X(n._value))}function w(n){return n instanceof W?n:E(new W,n)}function b(n,t){n._state||(n._state=st,n._value=t,I(n))}function y(n,t){n._state||(K&&a(t),n._state=ht,n._value=t,V&&(n._domain=process.domain),I(n))}function x(n,t){t._state||(t._state=n._state,t._value=n._value,t._domain=n._domain,I(t))}function E(n,t){if(n._state)return n;if(t instanceof W)j(n,t);else{var e=typeof t;"object"===e&&null!==t||"function"===e?N(n,t):b(n,t)}return n}function j(n,t){t===n?y(n,new TypeError("You can't resolve a promise with itself")):t._state?x(t,n):S(t,pt,n)}function N(n,t){var e=k(n,t);"function"==typeof e?O(C(n,!1),e,t):b(n,t)}function k(n,t){try{return t.then}catch(e){return y(n,e),null}}function O(n,t,e){try{at.call(t,e,n.resolve,n.reject)}catch(r){n.reject(r)}}function I(n){n._pending&&(T(n,n._op,n._pending),n._pending=null)}function T(n,t,e){if(t>=0)e(n,t);else if(t===pt)d(n,e);else for(var r=0,i=e.length;i>r;r+=2)T(n,e[r],e[r+1])}function S(n,t,e){n._state?T(n,t,e):n._pending?n._op===_t?n._pending.push(t,e):(n._pending=[n._op,n._pending,t,e],n._op=_t):(n._pending=e,n._op=t)}function F(n,t){var e=n._domain||t._domain;K=t._trace;var r=n._state===st?t._cb:t._eb;t._cb=null,t._eb=null,t._domain=null,t._trace=null,null===r?x(n,t):e?e._disposed||(e.enter(),A(t,r,n._value),e.exit()):A(t,r,n._value)}function A(n,t,e){var r;try{r=t(e)}catch(i){return void y(n,i)}E(n,r)}function C(n,t){function r(e,r){if(n){var o=n;n=null,i&&(K?i=null:K=i),e?y(o,t?e:r):E(o,r),i&&(K=i=null)}}var i=w.longStackSupport?e():null;return t?r:{promise:n,resolve:function(n){r(!1,n)},reject:function(n){r(!0,n)}}}function H(){return C(new W,!1)}function P(n){var t=new W;return y(t,n),t}function W(){this._state=0,this._value=void 0,this._domain=null,this._cb=null,this._eb=null,this._op=0,this._pending=null,this._trace=null}function M(n){var t=q(n);return t._state?t:t._clone()}function q(n){function t(n,t){i[t]=n.inspect(),0===--o&&b(e,i)}var e=new W,r=n.length;if("number"!=typeof r)return y(e,new TypeError("input not array-like")),e;for(var i=new Array(r),o=r,u=0;r>u;++u)S(w(n[u]),u,t);return 0===o&&b(e,i),e}function D(n){var t=L(n);return t._state?t:t._clone()}function L(n){function t(n,t){null!==o&&(n._state===ht?(o=null,x(n,e),e=null):(o[t]=n._value,0===--u&&b(e,o)))}var e=new W,r=n.length,i=e;if("number"!=typeof r)return y(e,new TypeError("input not array-like")),e;for(var o=new Array(r),u=r,c=0;r>c;++c)S(w(n[c]),c,t);return 0===u&&b(e,o),i}function R(n,t,e){return L(n).then(function(n){return lt.call(t,void 0,n)},e)}function U(n){function t(t){return at.apply(n,t)}return function(){var n=arguments.length,e=new Array(n+1);e[0]=this;for(var r=0;n>r;++r)e[r+1]=arguments[r];return L(e).then(t)}}function G(n){return function(){var t=new W,e=arguments.length,r=new Array(e+1);for(r[e]=C(t,!0);e--;)r[e]=arguments[e];return Q(t,n,this,r),t}}function Q(n,t,e,r){try{lt.call(t,e,r)}catch(i){y(n,i)}}var $,z=n,J=i(),K=null;(new Error).stack&&(z=function(n){return n});var X,Y,B="\nFrom previous event:\n",V=f(typeof process)&&null!=process&&"[object process]"==={}.toString.call(process),Z="function"==typeof setImmediate,nt=f(typeof MutationObserver)&&MutationObserver||f(typeof WebKitMutationObserver)&&WebKitMutationObserver,tt=new l,et=tt,rt=!1,it=0,ot=V?p:nt?_(h):v(h),ut=[],ct=v(s),at=f.call,lt=f.apply;et.next=tt,X=V?function(n){throw K=null,ot(),n}:function(n){ut.push(n),ct()};var ft=0,st=1,ht=2,dt=0,pt=-1,_t=-2,vt=w(void 0);w.longStackSupport=!1,w.defer=H,w.reject=P,W.prototype._clone=function(){var n=new W;return j(n,this),n},W.prototype.then=function(n,t){var r=new W;return r._cb="function"==typeof n?n:null,r._eb="function"==typeof t?t:null,w.longStackSupport&&(r._trace=e()),V&&(r._domain=process.domain),this._state?d(this,r):S(this,pt,r),r},W.prototype.done=function(n,t){var e=this;(n||t)&&(e=e.then(n,t)),e=e.then(null,m),S(e,dt,g)},W.prototype.fail=function(n){return this.then(null,n)},W.prototype.fin=function(n){function t(){return w(n()).then(function(){x(e,r)})}var e=this,r=e.then(t,t);return r},W.prototype.spread=function(n,t){return this.then(L).then(function(t){return lt.call(n,void 0,t)},t)},W.prototype.timeout=function(n,t){var r=this._clone();if(this._state===ft){var i=w.longStackSupport?e():null,o=setTimeout(function(){K=i,y(r,new Error(t||"Timed out after "+n+" ms")),K=null},n);S(this,dt,function(){clearTimeout(o)})}return r},W.prototype.delay=function(n){var t=new W;return S(this,dt,function(e){e._state===st?setTimeout(function(){x(e,t)},n):vt.then(function(){x(e,t)})}),t},W.prototype.all=function(){return this.then(L)},W.prototype.allSettled=function(){return this.then(q)},W.prototype.inspect=function(){switch(this._state){case ft:return{state:"pending"};case st:return{state:"fulfilled",value:this._value};case ht:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}},W.prototype.nodeify=function(n){return n?void this.done(function(t){n(null,t)},n):this},w.allSettled=M,w.all=D,w.spread=R,w.promised=U,w.denodeify=G,w.onerror=null,w.nextTick=function(n){var t=vt.then(function(){n.call()});S(t,dt,g)};var mt=i();return w}),e("client/lib/object",[],function(){function n(n){for(var t,e=[].slice.call(arguments,1),r=0;t=e[r];++r)for(var i in t)n[i]=t[i];return n}return{extend:n}}),e("client/lib/options",[],function(){function n(n,t){for(var e,r=0;e=n[r];++r)if(!(e in t))throw new Error(e+" is required")}return{checkRequired:n}}),e("client/lib/constants",[],function(){return{DEFAULT_FXA_HOST:"https://accounts.firefox.com",SIGNIN_ENDPOINT:"oauth/signin",SIGNUP_ENDPOINT:"oauth/signup",FORCE_EMAIL_ENDPOINT:"force_auth"}}),e("client/lib/url",[],function(){function n(n,t){return n+"="+encodeURIComponent(t)}function t(t){var e=[];for(var r in t)e.push(n(r,t[r]));return"?"+e.join("&")}return{createQueryParam:n,objectToQueryString:t}}),e("client/auth/api",["p-promise","client/lib/constants","client/lib/options","client/lib/url"],function(n,t,e,r){function i(n,e){if(!n)throw new Error("clientId is required");this._clientId=n,this._fxaHost=e.fxaHost||t.DEFAULT_FXA_HOST,this._window=e.window||window}function o(t,r){var i=this;return n().then(function(){var n=["scope","state","redirect_uri"];e.checkRequired(n,r);var o=u.call(i,t,r);return i.openFxa(o)})}function u(n,t){var e={client_id:this._clientId,state:t.state,scope:t.scope,redirect_uri:t.redirect_uri};return t.force_email&&(e.email=t.force_email),this._fxaHost+"/"+n+r.objectToQueryString(e)}return i.prototype={openFxa:function(){throw new Error("openFxa must be overridden")},signIn:function(n){n=n||{};var e=n.force_email?t.FORCE_EMAIL_ENDPOINT:t.SIGNIN_ENDPOINT;return o.call(this,e,n)},signUp:function(n){return o.call(this,t.SIGNUP_ENDPOINT,n)}},i}),e("client/auth/lightbox/lightbox",[],function(){function n(n,t,e){var r=n.document.createElement(t);for(var i in e)r.setAttribute(i,e[i]);return r}function t(n){var t="";for(var e in n)t+=e+":"+n[e]+";";return t}function e(n){n=n||{},this._window=n.window}return e.prototype={load:function(e){var r=this._backgroundEl=n(this._window,"div",{style:t({background:"rgba(0,0,0,0.5)",bottom:0,left:0,position:"fixed",right:0,top:0})}),i=n(this._window,"iframe",{id:"fxa",src:e,width:"600",height:"400",allowtransparency:"true",border:"0",style:t({background:"transparent",border:"none",display:"block",height:"600px",margin:"0 auto 0 auto",position:"relative",top:"10%",width:"400px"})});r.appendChild(i),this._window.document.body.appendChild(r),this._iframe=i,this._contentWindow=i.contentWindow},getContentElement:function(){return this._iframe},getContentWindow:function(){return this._contentWindow},isLoaded:function(){return!!this._backgroundEl},unload:function(){this._backgroundEl&&(this._window.document.body.removeChild(this._backgroundEl),delete this._backgroundEl,delete this._iframe)}},e}),e("client/auth/lightbox/iframe_channel",["p-promise","client/lib/object"],function(n,t){function e(n){n=n||{},this._window=n.window,this._contentWindow=n.contentWindow,this._iframeHost=n.iframeHost}function r(n){if(n.origin===this._iframeHost){var t=i(n.data),e=t.command,r=t.data,o=u[e]||u.ignore;o.call(this,e,r)}}function i(n){var t=n.split("!!!");return{command:t[0],data:JSON.parse(t[1]||"{}")}}function o(n,t){return n+"!!!"+JSON.stringify(t||"")}e.prototype={version:"0.0.0",attach:function(){return this._boundOnMessage=r.bind(this),this._window.addEventListener("message",this._boundOnMessage,!1),this._deferred=n.defer(),this._deferred.promise},detach:function(){this._window.removeEventListener("message",this._boundOnMessage,!1)},send:function(n,e){var r=t.extend({version:this.version},e),i=o(n,r);this._contentWindow.postMessage(i,this._iframeHost)}};var u={error:function(n,t){this.detach(),this._deferred.reject(t)},ping:function(n,t){this.send(n,t)},ignore:function(n){console.log("ignoring command: %s",n)},oauth_cancel:function(){return this.detach(),this._deferred.reject({reason:"cancel"})},oauth_complete:function(n,t){this.detach(),this._deferred.resolve(t)}};return e.stringifyFxAEvent=o,e.parseFxAEvent=i,e}),e("client/auth/lightbox/api",["p-promise","client/lib/object","client/lib/options","../api","./lightbox","./iframe_channel"],function(n,t,e,r,i,o){function u(){var n=this;return n._lightbox?n._lightbox:(n._lightbox=new i({window:n._window}),n._lightbox)}function c(t){var e=this;return n().then(function(){if(e._lightbox&&e._lightbox.isLoaded())throw new Error("lightbox already open");var n=u.call(e);return n.load(t),n})}function a(n){var t=this;return t._channel?t._channel:(t._channel=new o({iframeHost:t._fxaHost,contentWindow:n.getContentWindow(),window:t._window}),t._channel)}function l(t){var e=this;return n().then(function(){var n=a.call(e,t);return n.attach()})}function f(n,t){r.call(this,n,t),t=t||{},this._lightbox=t.lightbox,this._channel=t.channel}return f.prototype=Object.create(r.prototype),t.extend(f.prototype,{openFxa:function(n){var t=this;return c.call(t,n).then(function(n){return l.call(t,n)}).then(function(n){return t.unload(),n},function(n){throw t.unload(),n})},unload:function(){var t=this;return n().then(function(){if(!t._lightbox)throw new Error("lightbox not open");t._lightbox.unload(),t._channel.detach()})}}),f}),e("client/auth/redirect/api",["../api","client/lib/constants","client/lib/options","client/lib/object"],function(n,t,e,r){function i(t,e){n.call(this,t,e)}return i.prototype=Object.create(n.prototype),r.extend(i.prototype,{openFxa:function(n){this._window.location.href=n}}),i}),e("client/FxaRelierClient",["p-promise","client/auth/lightbox/api","client/auth/redirect/api"],function(n,t,e){function r(n,t,e,r){if(n._ui)throw new Error("Firefox Accounts is already open");if("object"==typeof t)n._ui=t;else{t=t||"default";var i=o[t];if(!i)throw new Error("Invalid ui: "+t);n._ui=new i(e,r)}return n._ui}function i(t,e){if(!t)throw new Error("clientId is required");this.auth={signIn:function(i){var o=this;return n().then(function(){i=i||{};var n=r(o,i.ui,t,e);return n.signIn(i).fin(function(){delete o._ui})})},signUp:function(i){var o=this;return n().then(function(){i=i||{};var n=r(o,i.ui,t,e);return n.signUp(i).fin(function(){delete o._ui})})}}}var o={"default":e,lightbox:t,redirect:e};return i.prototype={version:"0.0.0"},i}),n("client/FxaRelierClient")});
//# sourceMappingURL=fxa-relier.client.min.js.map